# restit
Turn simple command scripts into a custom json rest api sensor.

# Basic Workflow
<pre>1. Git clone this source code.
2. Create your set of scripts that output "Value Sensorname Optional_Message" for each line of output.
3. Edit main.csv using the syntax described below.
4. Build the source code and the installer package
5. Install your rest api sensor as root on each linux host that you want it to run on.
</pre>

<pre>main.csv syntax :
Category;Type;schedule_frequency_seconds;script_file;
</pre>

# Important rules
<pre>- Command scripts can be max 7900bytes long.
- Command scripts must always output "VALUE SENSORNAME OPTIONAL_MESSAGE" per line.
- Each line becomes a (sub)sensor and will have a separate entry in the json output.</pre>

# Build the application and create the package bundle
<pre>git clone https://github.com/oli4vr/restit.git
cd restit
make
make bundle</pre>

# Cleanup
<pre>make clean</pre>

# Install the package on linux hosts
The package file will look like restit.Distro.CPUarch.timestamp.sh
At this time install it as root if you want to autocreate a systemd service.
<pre>Install example :
./restit.SLES.x86_64.20230908.sh
Uninstall :
./restit.SLES.x86_64.20230908.sh -u
</pre>

# The installer bundle
The bundle file is a deployment script intended for easy deployment on linux hosts.
It is generated by the "make bundle" statement. The package is collected in a tar.gz and is then uuencoded plus embedded in the script.
Only use the script on systems with the same linux distribution and release version. The idea is that you can build your install bundle for each type of system to make automating your deployments easier.

# REST API listener
By default the rest api will be listening on port 40480, but this can be adapted in the config file.
You can connect to it using the http protocol.

<br />curl http://127.0.0.1:40480

# JSON formats
The following formats are available :
- Restit JSON format : http://127.0.0.1:40480/json    -> Default format
- Native PRTG format : http://127.0.0.1:40480/prtg    -> PRTG "HTTP Data Advanced"

# Filter/request specific sensors
You can filter a specific category, type or sensor by using it's name in the URL path. Searches work for all formats.

<br />Example : http://127.0.0.1:40480/prtg/fs_used

# Add (prtg compatible) thresholds to the reply
4 Variables are available :
- crithigh : Critical high threshold
- warnhigh : Warning high threshold
- critlow : Critical low threshold
- warnlow : Warning low threshold

<br />Example : http://127.0.0.1:40480/prtg/fs_used?crithigh=90&warnhigh=80

